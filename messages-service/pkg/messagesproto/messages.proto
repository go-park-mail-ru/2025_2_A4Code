syntax = "proto3";

package messagesproto;

// protoc --go_out=. --go-grpc_out=. --go-grpc_opt=paths=source_relative --go_opt=paths=source_relative *.proto
option go_package = "/;messagesproto";

message Message {
  string id = 1;
  Sender sender = 2;
  string topic = 3;
  string snippet = 4;
  string datetime = 5;
  string is_read = 6;
}

message FullMessage {
  string topic = 1;
  string text = 2;
  string datetime = 3;
  string thread_id = 4;
  Sender sender = 5;
  repeated File files = 6;
}

message Sender {
  string email = 1;
  string username = 2;
  string avatar = 3;
}

message Receiver {
  string email = 1; 
}

message File {
  string name = 1;
  string file_type = 2;
  string size = 3;          
  string storage_path = 4;
}

message PaginationInfo {
  string has_next = 1;          
  string next_last_message_id = 2;
  string next_last_datetime = 3;
}

message Folder {
  string folder_id = 1;
  string folder_name = 2;
  string folder_type = 3;
}

message MessagesInfo {
  string message_total = 1;
  string message_unread = 2;
}

service MessagesService {
  // Основные методы для сообщений
  rpc Inbox(InboxRequest) returns (InboxResponse);
  rpc MessagePage(MessagePageRequest) returns (MessagePageResponse);
  rpc Reply(ReplyRequest) returns (ReplyResponse);
  rpc Send(SendRequest) returns (SendResponse);
  rpc Sent(SentRequest) returns (SentResponse);

  // Методы для работы с сообщениями
  rpc MarkAsSpam(MarkAsSpamRequest) returns (MarkAsSpamResponse);
  rpc MoveToFolder(MoveToFolderRequest) returns (MoveToFolderResponse);

  // Методы для папок
  rpc CreateFolder(CreateFolderRequest) returns (CreateFolderResponse);
  rpc GetFolder(GetFolderRequest) returns (GetFolderResponse);
  rpc GetFolders(GetFoldersRequest) returns (GetFoldersResponse);
  rpc RenameFolder(RenameFolderRequest) returns (RenameFolderResponse);
  rpc DeleteFolder(DeleteFolderRequest) returns (DeleteFolderResponse);
  rpc DeleteMessageFromFolder(DeleteMessageFromFolderRequest) returns (DeleteMessageFromFolderResponse);

  // Методы для черновиков
  rpc SaveDraft(SaveDraftRequest) returns (SaveDraftResponse);
  rpc DeleteDraft(DeleteDraftRequest) returns (DeleteDraftResponse);
  rpc SendDraft(SendDraftRequest) returns (SendDraftResponse);
}

// Основные методы для сообщений
message InboxRequest {
  string last_message_id = 1;
  string last_datetime = 2;
  string limit = 3;
}

message InboxResponse {
  string message_total = 1;
  string message_unread = 2;
  repeated Message messages = 3;
  PaginationInfo pagination = 4;
}

message MessagePageRequest {
  string message_id = 1;
}

message MessagePageResponse {
  FullMessage message = 1;
}

message ReplyRequest {
  string root_message_id = 1;
  string topic = 2;
  string text = 3;
  string thread_root = 4;     
  repeated Receiver receivers = 5;
  repeated File files = 6;
}

message ReplyResponse {
  string message_id = 1;
}

message SendRequest {
  string topic = 1;
  string text = 2;
  repeated Receiver receivers = 3; 
  repeated File files = 4;         
}

message SendResponse {
  string message_id = 1;
}

message SentRequest {
  string last_message_id = 1;
  string last_datetime = 2;
  string limit = 3;
}

message SentResponse {
  string message_total = 1;
  string message_unread = 2;
  repeated Message messages = 3; 
  PaginationInfo pagination = 4;
}

// Методы для работы с сообщениями
message MarkAsSpamRequest {
  string message_id = 1;
}

message MarkAsSpamResponse {
}

message MoveToFolderRequest {
  string message_id = 1;
  string folder_id = 2;
}

message MoveToFolderResponse {
}

// Методы для папок
message CreateFolderRequest {
  string folder_name = 1;
}

message CreateFolderResponse {
  string folder_id = 1;
  string folder_name = 2;
  string folder_type = 3;
}

message GetFolderRequest {
  string folder_id = 1;
  string last_message_id = 2;
  string last_datetime = 3;
  string limit = 4;
}

message GetFolderResponse {
  string message_total = 1;
  string message_unread = 2;
  repeated Message messages = 3;
  PaginationInfo pagination = 4;
}

message GetFoldersRequest {
}

message GetFoldersResponse {
  repeated Folder folders = 1;
}

message RenameFolderRequest {
  string folder_id = 1;
  string new_folder_name = 2;
}

message RenameFolderResponse {
  string folder_id = 1;
  string folder_name = 2;
  string folder_type = 3;
}

message DeleteFolderRequest {
  string folder_id = 1;
}

message DeleteFolderResponse {
}

message DeleteMessageFromFolderRequest {
  string message_id = 1;
  string folder_id = 2;
}

message DeleteMessageFromFolderResponse {
}

// Методы для черновиков
message SaveDraftRequest {
  string draft_id = 1;
  string thread_id = 2;
  string topic = 3;
  string text = 4;
  repeated Receiver receivers = 5;
  repeated File files = 6;
}

message SaveDraftResponse {
  string draft_id = 1;
}

message DeleteDraftRequest {
  string draft_id = 1;
}

message DeleteDraftResponse {
  bool success = 1;
}

message SendDraftRequest {
  string draft_id = 1;
}

message SendDraftResponse {
  bool success = 1;
  string message_id = 2;
}